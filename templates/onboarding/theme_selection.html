{% extends 'base.html' %}
{% load static %}

{% block title %}Choose Your Theme - The Last Card{% endblock %}

{% block navigation %}{% endblock %}
{% block footer %}{% endblock %}

{% block body %}
<div class="min-h-screen flex">
    <!-- Left Side - Progress -->
    <div class="hidden lg:flex lg:w-1/3 bg-zinc-900 relative overflow-hidden items-center justify-center p-12">
        <div class="absolute inset-0 bg-gradient-to-br from-primary/20 via-transparent to-transparent"></div>
        <div class="absolute top-0 right-0 w-96 h-96 bg-primary/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-96 h-96 bg-primary/5 rounded-full blur-3xl"></div>
        
        <div class="relative z-10 max-w-md">
            <a href="{% url 'landing:home' %}" class="inline-flex items-center gap-3 mb-12">
                <div class="w-14 h-14 gold-gradient rounded-xl flex items-center justify-center shadow-lg">
                    <span class="material-icons-round text-black text-2xl">contactless</span>
                </div>
                <span class="font-display text-2xl tracking-wider uppercase font-bold" style="color: #fbad05;">The Last Card</span>
            </a>
            
            <!-- Progress Steps -->
            <div class="space-y-6">
                <div class="flex items-center gap-4 opacity-50">
                    <div class="w-10 h-10 rounded-full bg-green-600 flex items-center justify-center text-white">
                        <span class="material-icons-round">check</span>
                    </div>
                    <div>
                        <p class="text-white font-semibold">Profile Information</p>
                        <p class="text-slate-400 text-sm">Completed</p>
                    </div>
                </div>
                <div class="ml-5 h-8 border-l-2 border-primary"></div>
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 rounded-full gold-gradient flex items-center justify-center text-black font-bold">2</div>
                    <div>
                        <p class="text-white font-semibold">Choose Theme</p>
                        <p class="text-slate-400 text-sm">Customize your look</p>
                    </div>
                </div>
                <div class="ml-5 h-8 border-l-2 border-slate-700"></div>
                <div class="flex items-center gap-4 opacity-50">
                    <div class="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center text-white font-bold">3</div>
                    <div>
                        <p class="text-white font-semibold">Your Profile URL</p>
                        <p class="text-slate-400 text-sm">Ready to share</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Side - Theme Selection -->
    <div class="w-full lg:w-2/3 flex items-center justify-center p-8 bg-background-light dark:bg-background-dark overflow-y-auto">
        <div class="w-full max-w-3xl">
            <!-- Mobile Logo -->
            <a href="{% url 'landing:home' %}" class="lg:hidden flex items-center justify-center gap-2 mb-6">
                <div class="w-10 h-10 gold-gradient rounded-lg flex items-center justify-center">
                    <span class="material-icons-round text-black">contactless</span>
                </div>
                <span class="font-display text-xl tracking-wider uppercase font-bold" style="color: #fbad05;">The Last Card</span>
            </a>

            <!-- Mobile Progress -->
            <div class="lg:hidden flex items-center justify-center gap-2 mb-6">
                <div class="w-8 h-8 rounded-full bg-green-600 flex items-center justify-center text-white text-sm">
                    <span class="material-icons-round text-sm">check</span>
                </div>
                <div class="w-8 h-1 bg-primary rounded"></div>
                <div class="w-8 h-8 rounded-full gold-gradient flex items-center justify-center text-black text-sm font-bold">2</div>
                <div class="w-8 h-1 bg-slate-200 dark:bg-zinc-700 rounded"></div>
                <div class="w-8 h-8 rounded-full bg-slate-200 dark:bg-zinc-700 flex items-center justify-center text-sm font-bold">3</div>
            </div>

            <div class="mb-8 text-center">
                <h1 class="font-display text-3xl mb-2">Choose Your Theme</h1>
                <p class="text-slate-500 dark:text-slate-400">Select a theme that represents your personal brand</p>
            </div>

            <form method="post" id="themeForm">
                {% csrf_token %}
                <input type="hidden" name="theme_id" id="selectedTheme" value="">
                
                <!-- Theme Grid -->
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                    {% for theme in themes %}
                    <div class="theme-card group cursor-pointer" data-theme-id="{{ theme.id }}" onclick="selectTheme('{{ theme.id }}', this)">
                        <div class="relative rounded-2xl overflow-hidden border-2 border-slate-200 dark:border-zinc-700 transition-all duration-300 hover:border-primary hover:shadow-xl group-[.selected]:border-primary group-[.selected]:ring-4 group-[.selected]:ring-primary/20">
                            <!-- Theme Preview -->
                            <div class="aspect-[3/4] p-4" style="background: {{ theme.background_gradient|default:theme.background_color }};">
                                <!-- Mock Card Preview -->
                                <div class="h-full flex flex-col items-center justify-center text-center p-4 rounded-xl {% if theme.dark_mode %}bg-black/30{% else %}bg-white/80{% endif %} backdrop-blur-sm">
                                    <div class="w-16 h-16 rounded-full mb-3 flex items-center justify-center" style="background: {{ theme.primary_color }};">
                                        <span class="material-icons-round text-white text-2xl">person</span>
                                    </div>
                                    <div class="w-24 h-3 rounded mb-2" style="background: {{ theme.text_color }};"></div>
                                    <div class="w-20 h-2 rounded mb-4" style="background: {{ theme.primary_color }}; opacity: 0.7;"></div>
                                    <div class="space-y-2 w-full">
                                        <div class="h-8 rounded" style="background: {{ theme.primary_color }};"></div>
                                        <div class="h-8 rounded border-2" style="border-color: {{ theme.primary_color }};"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Theme Name -->
                            <div class="p-4 bg-white dark:bg-zinc-900 border-t border-slate-200 dark:border-zinc-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="font-semibold">{{ theme.name }}</h3>
                                        <p class="text-sm text-slate-500">{{ theme.description|truncatechars:30 }}</p>
                                    </div>
                                    <div class="w-6 h-6 rounded-full border-2 border-slate-300 dark:border-zinc-600 flex items-center justify-center theme-check">
                                        <span class="material-icons-round text-primary text-sm hidden">check</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Color Swatches -->
                            <div class="absolute top-4 right-4 flex gap-1">
                                <div class="w-4 h-4 rounded-full border border-white shadow" style="background: {{ theme.primary_color }};"></div>
                                <div class="w-4 h-4 rounded-full border border-white shadow" style="background: {{ theme.secondary_color }};"></div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <!-- Default themes if none exist -->
                    <div class="theme-card group cursor-pointer selected" data-theme-id="" onclick="selectTheme('', this)">
                        <div class="relative rounded-2xl overflow-hidden border-2 border-primary ring-4 ring-primary/20 transition-all duration-300">
                            <div class="aspect-[3/4] p-4 bg-gradient-to-br from-indigo-500 to-purple-600">
                                <div class="h-full flex flex-col items-center justify-center text-center p-4 rounded-xl bg-white/80 backdrop-blur-sm">
                                    <div class="w-16 h-16 rounded-full mb-3 bg-indigo-500 flex items-center justify-center">
                                        <span class="material-icons-round text-white text-2xl">person</span>
                                    </div>
                                    <div class="w-24 h-3 rounded mb-2 bg-slate-800"></div>
                                    <div class="w-20 h-2 rounded mb-4 bg-indigo-500 opacity-70"></div>
                                    <div class="space-y-2 w-full">
                                        <div class="h-8 rounded bg-indigo-500"></div>
                                        <div class="h-8 rounded border-2 border-indigo-500"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 bg-white dark:bg-zinc-900 border-t border-slate-200 dark:border-zinc-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="font-semibold">Professional</h3>
                                        <p class="text-sm text-slate-500">Clean & modern</p>
                                    </div>
                                    <div class="w-6 h-6 rounded-full border-2 border-primary bg-primary flex items-center justify-center theme-check">
                                        <span class="material-icons-round text-black text-sm">check</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="theme-card group cursor-pointer" data-theme-id="" onclick="selectTheme('', this)">
                        <div class="relative rounded-2xl overflow-hidden border-2 border-slate-200 dark:border-zinc-700 transition-all duration-300 hover:border-primary hover:shadow-xl">
                            <div class="aspect-[3/4] p-4 bg-slate-900">
                                <div class="h-full flex flex-col items-center justify-center text-center p-4 rounded-xl bg-black/30 backdrop-blur-sm">
                                    <div class="w-16 h-16 rounded-full mb-3 bg-cyan-400 flex items-center justify-center">
                                        <span class="material-icons-round text-black text-2xl">person</span>
                                    </div>
                                    <div class="w-24 h-3 rounded mb-2 bg-white"></div>
                                    <div class="w-20 h-2 rounded mb-4 bg-cyan-400 opacity-70"></div>
                                    <div class="space-y-2 w-full">
                                        <div class="h-8 rounded bg-cyan-400"></div>
                                        <div class="h-8 rounded border-2 border-cyan-400"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 bg-white dark:bg-zinc-900 border-t border-slate-200 dark:border-zinc-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="font-semibold">Dark Mode</h3>
                                        <p class="text-sm text-slate-500">Sleek & modern</p>
                                    </div>
                                    <div class="w-6 h-6 rounded-full border-2 border-slate-300 dark:border-zinc-600 flex items-center justify-center theme-check">
                                        <span class="material-icons-round text-primary text-sm hidden">check</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="theme-card group cursor-pointer" data-theme-id="" onclick="selectTheme('', this)">
                        <div class="relative rounded-2xl overflow-hidden border-2 border-slate-200 dark:border-zinc-700 transition-all duration-300 hover:border-primary hover:shadow-xl">
                            <div class="aspect-[3/4] p-4 bg-gradient-to-br from-amber-400 via-orange-500 to-pink-500">
                                <div class="h-full flex flex-col items-center justify-center text-center p-4 rounded-xl bg-white/80 backdrop-blur-sm">
                                    <div class="w-16 h-16 rounded-full mb-3 bg-orange-500 flex items-center justify-center">
                                        <span class="material-icons-round text-white text-2xl">person</span>
                                    </div>
                                    <div class="w-24 h-3 rounded mb-2 bg-slate-800"></div>
                                    <div class="w-20 h-2 rounded mb-4 bg-orange-500 opacity-70"></div>
                                    <div class="space-y-2 w-full">
                                        <div class="h-8 rounded bg-orange-500"></div>
                                        <div class="h-8 rounded border-2 border-orange-500"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 bg-white dark:bg-zinc-900 border-t border-slate-200 dark:border-zinc-700">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h3 class="font-semibold">Sunset</h3>
                                        <p class="text-sm text-slate-500">Warm & vibrant</p>
                                    </div>
                                    <div class="w-6 h-6 rounded-full border-2 border-slate-300 dark:border-zinc-600 flex items-center justify-center theme-check">
                                        <span class="material-icons-round text-primary text-sm hidden">check</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <div class="flex items-center gap-4">
                    <a href="{% url 'accounts:onboarding_profile' %}" class="px-6 py-4 border border-slate-200 dark:border-zinc-700 rounded-xl hover:bg-slate-50 dark:hover:bg-zinc-800 transition-colors font-medium flex items-center gap-2">
                        <span class="material-icons-round">arrow_back</span>
                        Back
                    </a>
                    <button type="submit" class="flex-1 py-4 bg-primary text-black font-bold rounded-xl hover:brightness-110 transition-all flex items-center justify-center gap-2">
                        Create My Profile
                        <span class="material-icons-round">arrow_forward</span>
                    </button>
                </div>
            </form>

            <p class="mt-6 text-center text-sm text-slate-500">
                You can change your theme anytime from your dashboard
            </p>
        </div>
    </div>
</div>

<script>
function selectTheme(themeId, element) {
    // Remove selected class from all cards
    document.querySelectorAll('.theme-card').forEach(card => {
        card.classList.remove('selected');
        const checkIcon = card.querySelector('.theme-check span');
        checkIcon.classList.add('hidden');
        card.querySelector('.theme-check').classList.remove('border-primary', 'bg-primary');
        card.querySelector('.theme-check').classList.add('border-slate-300', 'dark:border-zinc-600');
        const borderDiv = card.querySelector('.relative');
        borderDiv.classList.remove('border-primary', 'ring-4', 'ring-primary/20');
        borderDiv.classList.add('border-slate-200', 'dark:border-zinc-700');
    });
    
    // Add selected class to clicked card
    element.classList.add('selected');
    const checkIcon = element.querySelector('.theme-check span');
    checkIcon.classList.remove('hidden');
    element.querySelector('.theme-check').classList.add('border-primary', 'bg-primary');
    element.querySelector('.theme-check').classList.remove('border-slate-300', 'dark:border-zinc-600');
    const borderDiv = element.querySelector('.relative');
    borderDiv.classList.remove('border-slate-200', 'dark:border-zinc-700');
    borderDiv.classList.add('border-primary', 'ring-4', 'ring-primary/20');
    
    // Set the hidden input value
    document.getElementById('selectedTheme').value = themeId;
}

// Select first theme by default
document.addEventListener('DOMContentLoaded', function() {
    const firstTheme = document.querySelector('.theme-card');
    if (firstTheme) {
        selectTheme(firstTheme.dataset.themeId, firstTheme);
    }
});
</script>
{% endblock %}
