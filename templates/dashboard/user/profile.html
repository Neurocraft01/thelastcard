{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Profile - The Last Card{% endblock %}

{% block body %}
<div class="min-h-screen bg-slate-50 dark:bg-background-dark">
    {% include 'dashboard/components/sidebar.html' %}

    <!-- Main Content with Live Preview -->
    <main class="lg:ml-[280px] min-h-screen">
        <div class="p-6 lg:p-8">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-2xl font-bold">Edit Profile</h1>
                <p class="text-slate-500 dark:text-slate-400">Update your personal information and see live preview.</p>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Form Section -->
                <div class="space-y-6">
                    <form method="post" enctype="multipart/form-data" id="profileForm">
                        {% csrf_token %}

                    <!-- Profile Photo -->
                    <div class="bg-white dark:bg-zinc-900 rounded-2xl border border-slate-200 dark:border-zinc-800 p-6">
                        <div class="flex items-center gap-6">
                            <div class="w-24 h-24 rounded-2xl bg-slate-100 dark:bg-zinc-800 flex items-center justify-center overflow-hidden border-2 border-dashed border-slate-300 dark:border-zinc-600">
                                {% if user.profile.profile_photo %}
                                <img src="{{ user.profile.profile_photo.url }}" alt="Profile" class="w-full h-full object-cover" id="photoPreview">
                                {% else %}
                                <span class="material-icons-round text-slate-400 text-4xl" id="photoPlaceholder">person</span>
                                <img src="" alt="Preview" class="w-full h-full object-cover hidden" id="photoPreview">
                                {% endif %}
                            </div>
                            <div>
                                <label for="profile_photo" class="inline-flex items-center gap-2 px-4 py-2 bg-primary text-black font-semibold rounded-xl hover:brightness-110 transition-all cursor-pointer">
                                    <span class="material-icons-round text-lg">upload</span>
                                    Change Photo
                                </label>
                                <input type="file" name="profile_photo" id="profile_photo" class="hidden" accept="image/*">
                                <p class="text-sm text-slate-500 mt-2">JPG, GIF or PNG. Max size 2MB.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Information -->
                    <div class="bg-white dark:bg-zinc-900 rounded-2xl border border-slate-200 dark:border-zinc-800">
                        <div class="px-6 py-4 border-b border-slate-200 dark:border-zinc-800">
                            <h3 class="font-semibold flex items-center gap-2">
                                <span class="material-icons-round text-primary">person</span>
                                Personal Information
                            </h3>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label for="first_name" class="block text-sm font-medium mb-2">First Name</label>
                                    <input type="text" name="first_name" id="first_name" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" value="{{ form.first_name.value|default:'' }}">
                                    {% if form.first_name.errors %}<p class="text-red-500 text-sm mt-1">{{ form.first_name.errors.0 }}</p>{% endif %}
                                </div>
                                <div>
                                    <label for="last_name" class="block text-sm font-medium mb-2">Last Name</label>
                                    <input type="text" name="last_name" id="last_name" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" value="{{ form.last_name.value|default:'' }}">
                                    {% if form.last_name.errors %}<p class="text-red-500 text-sm mt-1">{{ form.last_name.errors.0 }}</p>{% endif %}
                                </div>
                            </div>
                            <div>
                                <label for="bio" class="block text-sm font-medium mb-2">Bio</label>
                                <textarea name="bio" id="bio" rows="3" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all resize-none" placeholder="Tell us a little about yourself...">{{ form.bio.value|default:'' }}</textarea>
                                {% if form.bio.errors %}<p class="text-red-500 text-sm mt-1">{{ form.bio.errors.0 }}</p>{% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Professional Details -->
                    <div class="bg-white dark:bg-zinc-900 rounded-2xl border border-slate-200 dark:border-zinc-800">
                        <div class="px-6 py-4 border-b border-slate-200 dark:border-zinc-800">
                            <h3 class="font-semibold flex items-center gap-2">
                                <span class="material-icons-round text-primary">work</span>
                                Professional Details
                            </h3>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label for="company" class="block text-sm font-medium mb-2">Company</label>
                                    <input type="text" name="company" id="company" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" value="{{ form.company.value|default:'' }}">
                                </div>
                                <div>
                                    <label for="designation" class="block text-sm font-medium mb-2">Job Title</label>
                                    <input type="text" name="designation" id="designation" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" value="{{ form.designation.value|default:'' }}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Details -->
                    <div class="bg-white dark:bg-zinc-900 rounded-2xl border border-slate-200 dark:border-zinc-800">
                        <div class="px-6 py-4 border-b border-slate-200 dark:border-zinc-800">
                            <h3 class="font-semibold flex items-center gap-2">
                                <span class="material-icons-round text-primary">contact_phone</span>
                                Contact Details
                            </h3>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label for="phone_primary" class="block text-sm font-medium mb-2">Primary Phone</label>
                                    <input type="tel" name="phone_primary" id="phone_primary" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" value="{{ form.phone_primary.value|default:'' }}">
                                </div>
                                <div>
                                    <label for="email_public" class="block text-sm font-medium mb-2">Public Email</label>
                                    <input type="email" name="email_public" id="email_public" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" value="{{ form.email_public.value|default:'' }}">
                                </div>
                            </div>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label for="website" class="block text-sm font-medium mb-2">Website</label>
                                    <input type="url" name="website" id="website" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" value="{{ form.website.value|default:'' }}" placeholder="https://">
                                </div>
                                <div>
                                    <label for="city" class="block text-sm font-medium mb-2">City</label>
                                    <input type="text" name="city" id="city" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all" value="{{ form.city.value|default:'' }}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <div class="flex justify-end">
                        <button type="submit" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-black font-bold rounded-xl hover:brightness-110 transition-all">
                            <span class="material-icons-round">save</span>
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>

            <!-- Live Preview Section -->
            <div class="lg:sticky lg:top-8">
                <div class="bg-white dark:bg-zinc-900 rounded-2xl border border-slate-200 dark:border-zinc-800 p-6">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="material-icons-round text-primary">preview</span>
                        Live Preview
                    </h3>
                    
                    <!-- Mobile Phone Mockup -->
                    <div class="mx-auto w-[280px]">
                        <div class="relative">
                            <!-- Phone Frame -->
                            <div class="bg-zinc-900 rounded-[48px] border-8 border-zinc-800 shadow-2xl overflow-hidden">
                                <!-- Screen -->
                                <div class="bg-white dark:bg-zinc-900 h-[560px] overflow-y-auto">
                                    <!-- Status Bar -->
                                    <div class="h-8 bg-zinc-900 flex items-center justify-between px-6 text-white text-xs sticky top-0 z-10">
                                        <span>9:41</span>
                                        <div class="flex gap-1">
                                            <span class="material-icons-round text-sm">signal_cellular_alt</span>
                                            <span class="material-icons-round text-sm">wifi</span>
                                            <span class="material-icons-round text-sm">battery_full</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Profile Preview Content -->
                                    <div class="p-6 space-y-6">
                                        <!-- Profile Photo Preview -->
                                        <div class="flex flex-col items-center">
                                            <div class="w-24 h-24 rounded-full overflow-hidden border-4 border-primary/20 mb-3">
                                                <img id="previewPhoto" src="{% if user.profile.profile_photo %}{{ user.profile.profile_photo.url }}{% else %}https://ui-avatars.com/api/?name={{ user.email|slice:':2' }}&background=D4AF37&color=000{% endif %}" alt="Preview" class="w-full h-full object-cover">
                                            </div>
                                            <h2 id="previewName" class="text-xl font-bold text-center">{% if user.first_name %}{{ user.first_name }} {{ user.last_name }}{% else %}Your Name{% endif %}</h2>
                                            <p id="previewDesignation" class="text-sm text-primary font-medium">{% if user.profile.designation %}{{ user.profile.designation }}{% else %}Your Title{% endif %}</p>
                                            <p id="previewCompany" class="text-sm text-slate-600 dark:text-slate-400">{% if user.profile.company %}{{ user.profile.company }}{% endif %}</p>
                                        </div>
                                        
                                        <!-- Bio Preview -->
                                        <div id="previewBioSection" class="{% if not user.profile.bio %}hidden{% endif %}">
                                            <p id="previewBio" class="text-sm text-slate-600 dark:text-slate-300 text-center">{{ user.profile.bio|default:"" }}</p>
                                        </div>
                                        
                                        <!-- Contact Info Preview -->
                                        <div class="space-y-3">
                                            <div id="previewPhoneSection" class="flex items-center gap-3 p-3 bg-slate-50 dark:bg-zinc-800 rounded-xl {% if not user.profile.phone_primary %}hidden{% endif %}">
                                                <span class="material-icons-round text-primary">phone</span>
                                                <span id="previewPhone" class="text-sm">{{ user.profile.phone_primary|default:"" }}</span>
                                            </div>
                                            <div id="previewEmailSection" class="flex items-center gap-3 p-3 bg-slate-50 dark:bg-zinc-800 rounded-xl {% if not user.profile.email_public %}hidden{% endif %}">
                                                <span class="material-icons-round text-primary">email</span>
                                                <span id="previewEmail" class="text-sm">{{ user.profile.email_public|default:"" }}</span>
                                            </div>
                                            <div id="previewWebsiteSection" class="flex items-center gap-3 p-3 bg-slate-50 dark:bg-zinc-800 rounded-xl {% if not user.profile.website %}hidden{% endif %}">
                                                <span class="material-icons-round text-primary">language</span>
                                                <span id="previewWebsite" class="text-sm">{{ user.profile.website|default:"" }}</span>
                                            </div>
                                            <div id="previewCitySection" class="flex items-center gap-3 p-3 bg-slate-50 dark:bg-zinc-800 rounded-xl {% if not user.profile.city %}hidden{% endif %}">
                                                <span class="material-icons-round text-primary">location_on</span>
                                                <span id="previewCity" class="text-sm">{{ user.profile.city|default:"" }}</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Save Contact Button -->
                                        <button class="w-full py-3 bg-primary text-black font-bold rounded-xl flex items-center justify-center gap-2">
                                            <span class="material-icons-round">person_add</span>
                                            Save Contact
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Notch -->
                                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-6 bg-zinc-800 rounded-b-2xl"></div>
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-xs text-center text-slate-500 mt-4">Changes will reflect in real-time</p>
                </div>
            </div>
        </div>
    </div>
    </main>
</div>

<script>
// Photo Preview
document.getElementById('profile_photo').addEventListener('change', function(e) {
    if (e.target.files && e.target.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('photoPreview');
            const placeholder = document.getElementById('photoPlaceholder');
            const previewPhoto = document.getElementById('previewPhoto');
            
            preview.src = e.target.result;
            preview.classList.remove('hidden');
            if (placeholder) placeholder.classList.add('hidden');
            
            // Update mobile preview
            if (previewPhoto) previewPhoto.src = e.target.result;
        }
        reader.readAsDataURL(e.target.files[0]);
    }
});

// Live Preview Updates
function updatePreview() {
    // Name
    const firstName = document.getElementById('first_name').value.trim();
    const lastName = document.getElementById('last_name').value.trim();
    const fullName = `${firstName} ${lastName}`.trim();
    document.getElementById('previewName').textContent = fullName || 'Your Name';
    
    // Designation
    const designation = document.getElementById('designation').value.trim();
    const previewDesignation = document.getElementById('previewDesignation');
    previewDesignation.textContent = designation || 'Your Title';
    previewDesignation.style.display = designation ? 'block' : 'none';
    
    // Company
    const company = document.getElementById('company').value.trim();
    const previewCompany = document.getElementById('previewCompany');
    previewCompany.textContent = company;
    previewCompany.style.display = company ? 'block' : 'none';
    
    // Bio
    const bio = document.getElementById('bio').value.trim();
    const previewBio = document.getElementById('previewBio');
    const previewBioSection = document.getElementById('previewBioSection');
    if (bio) {
        previewBio.textContent = bio;
        previewBioSection.classList.remove('hidden');
    } else {
        previewBioSection.classList.add('hidden');
    }
    
    // Phone
    const phone = document.getElementById('phone_primary').value.trim();
    const previewPhone = document.getElementById('previewPhone');
    const previewPhoneSection = document.getElementById('previewPhoneSection');
    if (phone) {
        previewPhone.textContent = phone;
        previewPhoneSection.classList.remove('hidden');
    } else {
        previewPhoneSection.classList.add('hidden');
    }
    
    // Email
    const email = document.getElementById('email_public').value.trim();
    const previewEmail = document.getElementById('previewEmail');
    const previewEmailSection = document.getElementById('previewEmailSection');
    if (email) {
        previewEmail.textContent = email;
        previewEmailSection.classList.remove('hidden');
    } else {
        previewEmailSection.classList.add('hidden');
    }
    
    // Website
    const website = document.getElementById('website').value.trim();
    const previewWebsite = document.getElementById('previewWebsite');
    const previewWebsiteSection = document.getElementById('previewWebsiteSection');
    if (website) {
        previewWebsite.textContent = website;
        previewWebsiteSection.classList.remove('hidden');
    } else {
        previewWebsiteSection.classList.add('hidden');
    }
    
    // City
    const city = document.getElementById('city').value.trim();
    const previewCity = document.getElementById('previewCity');
    const previewCitySection = document.getElementById('previewCitySection');
    if (city) {
        previewCity.textContent = city;
        previewCitySection.classList.remove('hidden');
    } else {
        previewCitySection.classList.add('hidden');
    }
}

// Attach event listeners to all form fields
const formFields = ['first_name', 'last_name', 'designation', 'company', 'bio', 'phone_primary', 'email_public', 'website', 'city'];
formFields.forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field) {
        field.addEventListener('input', updatePreview);
    }
});

// Initial update
updatePreview();
</script>
{% endblock %}